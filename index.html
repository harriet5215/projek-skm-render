<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borang Pergerakan Kakitangan SKM</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; padding: 20px; min-height: 100vh; margin: 0; }
        .container { background-color: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); width: 100%; max-width: 500px; }
        h2 { text-align: center; color: #333; margin-bottom: 5px; }
        #live-clock { text-align: center; color: #555; font-size: 0.9em; margin-bottom: 25px; }
        .form-group { margin-bottom: 15px; }
        .date-group { display: flex; gap: 10px; }
        .date-group .form-group { width: 50%; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #0056b3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #004494; }
        #success-message { display: none; text-align: center; padding: 40px 20px; }
        #success-message h2 { color: #28a745; margin-bottom: 15px; }
        #success-message p { font-size: 1.1em; color: #555; margin-bottom: 30px; }
        #success-message button { background-color: #28a745; }
        #success-message button:hover { background-color: #218838; }
        .nav-link { display: block; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="borang-utama">
            <h2>Sistem Pergerakan Kakitangan SKM</h2>
            <p id="live-clock"></p>
            <form id="pergerakan-form">
                <div class="form-group">
                    <label for="nama_staf">Nama Penuh:</label>
                    <input type="text" id="nama_staf" name="nama_staf" required>
                </div>
                <div class="form-group">
                    <label for="jenis_pergerakan">Jenis Pergerakan:</label>
                    <select id="jenis_pergerakan" name="jenis_pergerakan" required>
                        <option value="">-- Sila Pilih --</option>
                        <option value="CR - Cuti Rehat">CR - Cuti Rehat</option>
                        <option value="MC - Cuti Sakit">MC - Cuti Sakit</option>
                        <option value="CG - Cuti Gantian">CG - Cuti Gantian</option>
                        <option value="UR - Urusan Rasmi/Koperasi">UR - Urusan Rasmi/Koperasi</option>
                        <option value="CK - Cuti Kuarantin">CK - Cuti Kuarantin</option>
                        <option value="CB - Cuti Bersalin">CB - Cuti Bersalin</option>
                        <option value="Kebenaran 4 Jam / HRMIS">Kebenaran 4 Jam / HRMIS</option>
                        <option value="Kursus/Latihan">Kursus/Latihan</option>
                        <option value="Bekerja Dari Rumah">Bekerja Dari Rumah</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="destinasi">Destinasi/Lokasi:</label>
                    <input type="text" id="destinasi" name="destinasi" required>
                </div>
                <div class="date-group">
                    <div class="form-group">
                        <label for="tarikh_mula">Tarikh Mula:</label>
                        <input type="date" id="tarikh_mula" name="tarikh_mula" required>
                    </div>
                    <div class="form-group">
                        <label for="tarikh_akhir">Tarikh Akhir:</label>
                        <input type="date" id="tarikh_akhir" name="tarikh_akhir" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="tempat_bertugas">Tempat Bertugas:</label>
                    <select id="tempat_bertugas" name="tempat_bertugas" required>
                        <option value="">-- Sila Pilih --</option>
                        <option value="SKM Negeri Sabah">SKM Negeri Sabah</option>
                        <option value="SKM Wilayah PBS">SKM Wilayah PBS</option>
                        <option value="SKM Wilayah PBU">SKM Wilayah PBU</option>
                        <option value="SKM W.P Labuan">SKM W.P Labuan</option>
                        <option value="SKM Wilayah Beaufort">SKM Wilayah Beaufort</option>
                        <option value="SKM Wilayah Keningau">SKM Wilayah Keningau</option>
                        <option value="SKM Wilayah Ranau">SKM Wilayah Ranau</option>
                        <option value="SKM Wilayah Kota Marudu">SKM Wilayah Kota Marudu</option>
                        <option value="SKM Wilayah Sandakan">SKM Wilayah Sandakan</option>
                        <option value="SKM Wilayah Lahad Datu">SKM Wilayah Lahad Datu</option>
                        <option value="SKM Wilayah Tawau">SKM Wilayah Tawau</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tujuan">Tujuan:</label>
                    <textarea id="tujuan" name="tujuan" rows="3" required></textarea>
                </div>
                <button type="submit">Hantar Rekod Pergerakan</button>
            </form>
            <a href="dashboard.html" class="nav-link">Lihat Dashboard Rekod</a>
        </div>
        <div id="success-message">
            <h2>Permohonan Berjaya! âœ…</h2>
            <p>Terima kasih. Permohonan anda telah berjaya direkodkan.</p>
            <button id="kembali-button">Buat Permohonan Lain</button>
        </div>
    </div>

    <script>
        const form = document.getElementById('pergerakan-form');
        const borangUtama = document.getElementById('borang-utama');
        const successMessage = document.getElementById('success-message');
        const kembaliButton = document.getElementById('kembali-button');
        const SERVER_URL = 'https://projek-skm-server.onrender.com/submit-mohon';
        const clockElement = document.getElementById('live-clock');

        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            clockElement.textContent = now.toLocaleDateString('ms-MY', options);
        }
        setInterval(updateClock, 1000);
        updateClock();

        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.textContent = 'Menghantar...';
            submitButton.disabled = true;
            const formData = new FormData(form);
            const data = new URLSearchParams(formData);
            try {
                const response = await fetch(SERVER_URL, { method: 'POST', body: data });
                const result = await response.json();
                if (result.success) {
                    borangUtama.style.display = 'none';
                    successMessage.style.display = 'block';
                } else {
                    alert('Gagal menghantar permohonan. Sila cuba lagi.');
                }
            } catch (error) {
                console.error('Ralat:', error);
                alert('Tidak dapat berhubung dengan server. Pastikan server sedang berjalan.');
            } finally {
                submitButton.textContent = 'Hantar Rekod Pergerakan';
                submitButton.disabled = false;
            }
        });
        kembaliButton.addEventListener('click', function() {
            successMessage.style.display = 'none';
            borangUtama.style.display = 'block';
            form.reset();
        });
    </script>
</body>
</html>